<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Profile - Scratch C</title>
    <style>
        :root {
            --gold: #FFD700;
            --black: #000000;
            --wine: #722F37;
            --red: #FF0000;
            --green: #00FF00;
            --blue: #0000FF;
            --yellow: #FFFF00;
            --bg-dark: #121212;
            --bg-light: #1E1E1E;
            --text-light: #FFFFFF;
            --text-gray: #AAAAAA;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--bg-dark);
            color: var(--text-light);
            min-height: 100vh;
        }
        
        .navbar {
            background: linear-gradient(90deg, var(--black), var(--wine));
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.5);
        }
        
        .logo {
            font-size: 1.8rem;
            font-weight: bold;
            background: linear-gradient(45deg, var(--gold), var(--yellow));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        
        .nav-links {
            display: flex;
            gap: 20px;
            align-items: center;
        }
        
        .nav-link {
            color: var(--text-light);
            text-decoration: none;
            padding: 8px 15px;
            border-radius: 5px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .nav-link:hover, .nav-link.active {
            background: var(--wine);
            color: var(--gold);
        }
        
        .user-menu {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .balance-box {
            background: linear-gradient(45deg, var(--gold), var(--yellow));
            color: var(--black);
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9rem;
        }
        
        .profile-pic {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--blue);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            cursor: pointer;
            border: 2px solid var(--gold);
        }
        
        .main-content {
            padding-top: 80px;
            max-width: 1200px;
            margin: 0 auto;
            padding: 100px 20px 20px;
        }
        
        .profile-header {
            background: linear-gradient(135deg, var(--wine), var(--black));
            padding: 40px;
            border-radius: 20px;
            margin-bottom: 30px;
            border: 2px solid var(--gold);
            position: relative;
            overflow: hidden;
        }
        
        .profile-header::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 200px;
            height: 200px;
            background: radial-gradient(circle, var(--gold) 0%, transparent 70%);
            opacity: 0.1;
        }
        
        .profile-info {
            display: flex;
            align-items: center;
            gap: 30px;
            flex-wrap: wrap;
        }
        
        .profile-avatar {
            position: relative;
        }
        
        .avatar-image {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            border: 4px solid var(--gold);
            object-fit: cover;
            background: linear-gradient(45deg, var(--blue), var(--green));
        }
        
        .avatar-change {
            position: absolute;
            bottom: 10px;
            right: 10px;
            background: var(--gold);
            color: var(--black);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border: 2px solid var(--black);
        }
        
        .profile-details {
            flex: 1;
        }
        
        .profile-name {
            color: var(--gold);
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .profile-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: var(--wine);
            color: var(--gold);
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 0.9rem;
            margin-bottom: 20px;
        }
        
        .profile-stats {
            display: flex;
            gap: 30px;
            flex-wrap: wrap;
        }
        
        .stat-item {
            text-align: center;
        }
        
        .stat-number {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--gold);
        }
        
        .stat-label {
            color: var(--text-gray);
            font-size: 0.9rem;
        }
        
        .profile-actions {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }
        
        .profile-btn {
            padding: 12px 25px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: linear-gradient(45deg, var(--green), var(--blue));
            color: white;
        }
        
        .btn-secondary {
            background: linear-gradient(45deg, var(--gold), var(--yellow));
            color: var(--black);
        }
        
        .btn-danger {
            background: linear-gradient(45deg, var(--red), var(--wine));
            color: white;
        }
        
        .profile-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 20px rgba(255, 255, 255, 0.2);
        }
        
        .profile-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            background: var(--bg-light);
            padding: 15px;
            border-radius: 15px;
            border: 1px solid var(--wine);
            flex-wrap: wrap;
        }
        
        .profile-tab {
            padding: 15px 25px;
            background: var(--black);
            border: 1px solid var(--wine);
            color: var(--text-light);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .profile-tab.active, .profile-tab:hover {
            background: var(--wine);
            color: var(--gold);
            border-color: var(--gold);
        }
        
        .tab-content {
            background: var(--bg-light);
            border-radius: 15px;
            padding: 30px;
            border: 1px solid var(--wine);
            margin-bottom: 30px;
        }
        
        .section-title {
            color: var(--gold);
            margin-bottom: 25px;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .earnings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .earning-card {
            background: rgba(0, 0, 0, 0.3);
            padding: 25px;
            border-radius: 15px;
            border-left: 4px solid var(--green);
        }
        
        .earning-amount {
            font-size: 2rem;
            font-weight: bold;
            color: var(--green);
            margin-bottom: 10px;
        }
        
        .earning-label {
            color: var(--text-gray);
            font-size: 0.9rem;
        }
        
        .tasks-history {
            display: grid;
            gap: 15px;
        }
        
        .task-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            border-left: 4px solid var(--blue);
        }
        
        .task-info h4 {
            color: var(--text-light);
            margin-bottom: 5px;
        }
        
        .task-date {
            color: var(--text-gray);
            font-size: 0.9rem;
        }
        
        .task-amount {
            color: var(--green);
            font-weight: bold;
            font-size: 1.2rem;
        }
        
        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
        }
        
        .setting-group {
            background: rgba(0, 0, 0, 0.3);
            padding: 25px;
            border-radius: 15px;
        }
        
        .setting-item {
            margin-bottom: 20px;
        }
        
        .setting-label {
            display: block;
            color: var(--gold);
            margin-bottom: 10px;
            font-weight: 500;
        }
        
        .setting-control {
            width: 100%;
            padding: 15px;
            background: var(--black);
            border: 1px solid var(--wine);
            border-radius: 10px;
            color: var(--text-light);
            font-size: 1rem;
        }
        
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 30px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--wine);
            transition: .4s;
            border-radius: 34px;
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .toggle-slider {
            background-color: var(--green);
        }
        
        input:checked + .toggle-slider:before {
            transform: translateX(30px);
        }
        
        .theme-selector {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .theme-option {
            flex: 1;
            min-width: 120px;
            padding: 20px;
            border: 2px solid var(--wine);
            border-radius: 10px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s;
        }
        
        .theme-option.active {
            border-color: var(--gold);
            background: rgba(255, 215, 0, 0.1);
        }
        
        .theme-preview {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            margin: 0 auto 10px;
        }
        
        .theme-light {
            background: linear-gradient(45deg, #ffffff, #f0f0f0);
            border: 1px solid #ddd;
        }
        
        .theme-dark {
            background: linear-gradient(45deg, #121212, #1e1e1e);
            border: 1px solid #333;
        }
        
        .theme-auto {
            background: linear-gradient(45deg, #121212 50%, #ffffff 50%);
            border: 1px solid #666;
        }
        
        .referral-section {
            text-align: center;
            padding: 40px;
            background: linear-gradient(135deg, var(--wine), var(--black));
            border-radius: 15px;
            border: 1px solid var(--gold);
        }
        
        .referral-code {
            background: var(--black);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            font-family: monospace;
            font-size: 1.5rem;
            color: var(--gold);
            border: 2px dashed var(--gold);
        }
        
        .referral-stats {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin-top: 30px;
            flex-wrap: wrap;
        }
        
        .social-links {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }
        
        .social-link {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--wine);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            text-decoration: none;
            font-size: 1.2rem;
            transition: all 0.3s;
        }
        
        .social-link:hover {
            transform: translateY(-5px);
            background: var(--gold);
            color: var(--black);
        }
        
        .ads-container {
            margin: 40px 0;
            text-align: center;
        }
        
        .footer {
            text-align: center;
            padding: 20px;
            border-top: 1px solid var(--wine);
            color: var(--text-gray);
            margin-top: 50px;
        }
        
        .hidden {
            display: none !important;
        }
        
        .loading {
            text-align: center;
            padding: 50px;
            color: var(--gold);
        }
        
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            z-index: 2000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .modal-content {
            background: var(--bg-light);
            border-radius: 20px;
            border: 2px solid var(--gold);
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header {
            padding: 25px 30px;
            border-bottom: 1px solid var(--wine);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-title {
            color: var(--gold);
            font-size: 1.5rem;
        }
        
        .close-modal {
            background: var(--red);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-body {
            padding: 30px;
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 10px;
            color: var(--gold);
            font-weight: 500;
        }
        
        .form-control {
            width: 100%;
            padding: 15px;
            background: var(--black);
            border: 1px solid var(--wine);
            border-radius: 10px;
            color: var(--text-light);
            font-size: 1rem;
        }
        
        .form-actions {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }
        
        .submit-btn {
            flex: 1;
            padding: 18px;
            background: linear-gradient(45deg, var(--green), var(--blue));
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0, 255, 0, 0.3);
        }
        
        .withdraw-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .withdraw-option {
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid var(--wine);
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .withdraw-option:hover, .withdraw-option.active {
            border-color: var(--gold);
            background: rgba(255, 215, 0, 0.1);
        }
        
        .withdraw-icon {
            font-size: 2rem;
            margin-bottom: 10px;
        }
        
        @media (max-width: 768px) {
            .navbar {
                flex-direction: column;
                gap: 15px;
                padding: 15px;
            }
            
            .nav-links {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .main-content {
                padding-top: 140px;
            }
            
            .profile-info {
                flex-direction: column;
                text-align: center;
            }
            
            .profile-stats {
                justify-content: center;
            }
            
            .profile-actions {
                justify-content: center;
            }
            
            .profile-tabs {
                justify-content: center;
            }
            
            .theme-selector {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="logo">Scratch C</div>
        
        <div class="nav-links">
            <a href="/dashboard" class="nav-link">üè† Dashboard</a>
            <a href="/cinema" class="nav-link">üé¨ Cinema</a>
            <a href="/marketplace" class="nav-link">üõçÔ∏è Marketplace</a>
            <a href="/reading" class="nav-link">üìö Reading</a>
            <a href="/profile" class="nav-link active">üë§ Profile</a>
        </div>
        
        <div class="user-menu">
            <div class="balance-box" id="userBalance">
                <span id="balanceAmount">Loading...</span>
            </div>
            <div class="profile-pic" id="profilePic">
                <span id="profileInitial">U</span>
            </div>
        </div>
    </nav>
    
    <!-- Main Content -->
    <div class="main-content">
        <!-- Profile Header -->
        <div class="profile-header">
            <div class="profile-info">
                <div class="profile-avatar">
                    <img id="avatarImage" class="avatar-image" src="" alt="Profile Picture">
                    <div class="avatar-change" onclick="openAvatarUpload()">
                        ‚úèÔ∏è
                    </div>
                </div>
                
                <div class="profile-details">
                    <h1 class="profile-name" id="profileName">Loading...</h1>
                    
                    <div class="profile-badge" id="userBadge">
                        <span id="badgeIcon">‚≠ê</span>
                        <span id="badgeText">Member</span>
                    </div>
                    
                    <div class="profile-stats">
                        <div class="stat-item">
                            <div class="stat-number" id="memberSince">0</div>
                            <div class="stat-label">Days on Scratch C</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number" id="tasksCount">0</div>
                            <div class="stat-label">Tasks Completed</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number" id="booksRead">0</div>
                            <div class="stat-label">Books Read</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number" id="listingsCount">0</div>
                            <div class="stat-label">Marketplace Listings</div>
                        </div>
                    </div>
                    
                    <div class="profile-actions">
                        <button class="profile-btn btn-primary" onclick="openWithdrawModal()">
                            üí∞ Withdraw Earnings
                        </button>
                        <button class="profile-btn btn-secondary" onclick="openEditProfile()">
                            ‚úèÔ∏è Edit Profile
                        </button>
                        <button class="profile-btn btn-danger" onclick="logout()">
                            üö™ Logout
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Profile Tabs -->
        <div class="profile-tabs">
            <div class="profile-tab active" onclick="showTab('overview')">
                üìä Overview
            </div>
            <div class="profile-tab" onclick="showTab('earnings')">
                üí∞ Earnings
            </div>
            <div class="profile-tab" onclick="showTab('activity')">
                üìà Activity
            </div>
            <div class="profile-tab" onclick="showTab('settings')">
                ‚öôÔ∏è Settings
            </div>
            <div class="profile-tab" onclick="showTab('referral')">
                üë• Referral
            </div>
        </div>
        
        <!-- Overview Tab -->
        <div class="tab-content" id="overviewTab">
            <h2 class="section-title">üìä Profile Overview</h2>
            
            <div class="earnings-grid">
                <div class="earning-card">
                    <div class="earning-amount" id="totalEarned">‚Ç¶0.00</div>
                    <div class="earning-label">Total Earnings</div>
                </div>
                <div class="earning-card">
                    <div class="earning-amount" id="availableBalance">‚Ç¶0.00</div>
                    <div class="earning-label">Available Balance</div>
                </div>
                <div class="earning-card">
                    <div class="earning-amount" id="withdrawnAmount">‚Ç¶0.00</div>
                    <div class="earning-label">Total Withdrawn</div>
                </div>
                <div class="earning-card">
                    <div class="earning-amount" id="platformCut">‚Ç¶0.00</div>
                    <div class="earning-label">Platform Fees Paid</div>
                </div>
            </div>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 30px;">
                <div>
                    <h3 class="section-title">üéØ Recent Activity</h3>
                    <div class="tasks-history" id="recentActivity">
                        <div class="loading">Loading activity...</div>
                    </div>
                </div>
                
                <div>
                    <h3 class="section-title">üèÜ Achievements</h3>
                    <div style="display: grid; gap: 15px;">
                        <div style="display: flex; align-items: center; gap: 15px; padding: 15px; background: rgba(0,0,0,0.3); border-radius: 10px;">
                            <div style="font-size: 2rem;">üí∞</div>
                            <div>
                                <div style="font-weight: bold; color: var(--gold);">First Earnings</div>
                                <div style="color: var(--text-gray); font-size: 0.9rem;">Complete your first task</div>
                            </div>
                            <div style="margin-left: auto; color: var(--green);">‚úÖ</div>
                        </div>
                        <div style="display: flex; align-items: center; gap: 15px; padding: 15px; background: rgba(0,0,0,0.3); border-radius: 10px;">
                            <div style="font-size: 2rem;">üìö</div>
                            <div>
                                <div style="font-weight: bold; color: var(--gold);">Book Worm</div>
                                <div style="color: var(--text-gray); font-size: 0.9rem;">Read 5 books</div>
                            </div>
                            <div style="margin-left: auto; color: var(--text-gray);">0/5</div>
                        </div>
                        <div style="display: flex; align-items: center; gap: 15px; padding: 15px; background: rgba(0,0,0,0.3); border-radius: 10px;">
                            <div style="font-size: 2rem;">üõçÔ∏è</div>
                            <div>
                                <div style="font-weight: bold; color: var(--gold);">Marketplace Seller</div>
                                <div style="color: var(--text-gray); font-size: 0.9rem;">List 3 items for sale</div>
                            </div>
                            <div style="margin-left: auto; color: var(--text-gray);">0/3</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Earnings Tab -->
        <div class="tab-content hidden" id="earningsTab">
            <h2 class="section-title">üí∞ Earnings & Withdrawals</h2>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 30px; margin-bottom: 40px;">
                <div>
                    <h3 style="color: var(--gold); margin-bottom: 20px;">üìä Earnings Breakdown</h3>
                    <div style="background: rgba(0,0,0,0.3); padding: 25px; border-radius: 15px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 15px;">
                            <span style="color: var(--text-gray);">Offerwall Tasks:</span>
                            <span style="color: var(--green); font-weight: bold;" id="offerwallEarnings">‚Ç¶0.00</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 15px;">
                            <span style="color: var(--text-gray);">Referral Earnings:</span>
                            <span style="color: var(--green); font-weight: bold;" id="referralEarnings">‚Ç¶0.00</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 15px;">
                            <span style="color: var(--text-gray);">Book Donations:</span>
                            <span style="color: var(--green); font-weight: bold;" id="donationEarnings">‚Ç¶0.00</span>
                        </div>
                        <div style="height: 1px; background: var(--wine); margin: 20px 0;"></div>
                        <div style="display: flex; justify-content: space-between; font-size: 1.2rem;">
                            <span style="color: var(--gold);">Total Earned:</span>
                            <span style="color: var(--green); font-weight: bold;" id="totalEarningsBreakdown">‚Ç¶0.00</span>
                        </div>
                    </div>
                </div>
                
                <div>
                    <h3 style="color: var(--gold); margin-bottom: 20px;">üí∏ Withdrawal History</h3>
                    <div style="background: rgba(0,0,0,0.3); padding: 25px; border-radius: 15px; min-height: 200px;">
                        <div id="withdrawalHistory">
                            <div class="loading">Loading withdrawal history...</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div style="text-align: center; margin-top: 40px;">
                <button class="profile-btn btn-primary" onclick="openWithdrawModal()" style="padding: 15px 40px; font-size: 1.1rem;">
                    üí∞ Request Withdrawal
                </button>
                <p style="color: var(--text-gray); margin-top: 15px; font-size: 0.9rem;">
                    Minimum withdrawal: ‚Ç¶1,000 ‚Ä¢ Processed within 24-48 hours
                </p>
            </div>
        </div>
        
        <!-- Activity Tab -->
        <div class="tab-content hidden" id="activityTab">
            <h2 class="section-title">üìà Recent Activity</h2>
            
            <div style="display: flex; gap: 20px; margin-bottom: 30px; flex-wrap: wrap;">
                <button class="profile-tab active" onclick="filterActivity('all')" id="activityAll">
                    All Activities
                </button>
                <button class="profile-tab" onclick="filterActivity('tasks')" id="activityTasks">
                    Tasks
                </button>
                <button class="profile-tab" onclick="filterActivity('reading')" id="activityReading">
                    Reading
                </button>
                <button class="profile-tab" onclick="filterActivity('marketplace')" id="activityMarketplace">
                    Marketplace
                </button>
                <button class="profile-tab" onclick="filterActivity('cinema')" id="activityCinema">
                    Cinema
                </button>
            </div>
            
            <div class="tasks-history" id="activityList">
                <div class="loading">Loading activities...</div>
            </div>
        </div>
        
        <!-- Settings Tab -->
        <div class="tab-content hidden" id="settingsTab">
            <h2 class="section-title">‚öôÔ∏è Account Settings</h2>
            
            <div class="settings-grid">
                <div class="setting-group">
                    <h3 style="color: var(--gold); margin-bottom: 20px;">üë§ Profile Settings</h3>
                    
                    <div class="setting-item">
                        <label class="setting-label">Username</label>
                        <input type="text" id="settingsUsername" class="setting-control" value="Loading...">
                    </div>
                    
                    <div class="setting-item">
                        <label class="setting-label">Email Address</label>
                        <input type="email" id="settingsEmail" class="setting-control" value="Loading...">
                    </div>
                    
                    <div class="setting-item">
                        <label class="setting-label">Change Password</label>
                        <input type="password" id="settingsPassword" class="setting-control" placeholder="Enter new password">
                        <small style="color: var(--text-gray); display: block; margin-top: 5px;">Leave blank to keep current password</small>
                    </div>
                    
                    <button class="submit-btn" onclick="updateProfileSettings()" style="margin-top: 20px;">
                        Save Changes
                    </button>
                </div>
                
                <div class="setting-group">
                    <h3 style="color: var(--gold); margin-bottom: 20px;">üé® Appearance</h3>
                    
                    <div class="setting-item">
                        <label class="setting-label">Theme</label>
                        <div class="theme-selector">
                            <div class="theme-option active" onclick="selectTheme('light')">
                                <div class="theme-preview theme-light"></div>
                                <div>Light</div>
                            </div>
                            <div class="theme-option" onclick="selectTheme('dark')">
                                <div class="theme-preview theme-dark"></div>
                                <div>Dark</div>
                            </div>
                            <div class="theme-option" onclick="selectTheme('auto')">
                                <div class="theme-preview theme-auto"></div>
                                <div>Auto</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="setting-item">
                        <label class="setting-label">Notifications</label>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span>Email Notifications</span>
                            <label class="toggle-switch">
                                <input type="checkbox" id="emailNotifications" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 15px;">
                            <span>Push Notifications</span>
                            <label class="toggle-switch">
                                <input type="checkbox" id="pushNotifications" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                </div>
                
                <div class="setting-group">
                    <h3 style="color: var(--gold); margin-bottom: 20px;">üîí Privacy & Security</h3>
                    
                    <div class="setting-item">
                        <label class="setting-label">Profile Visibility</label>
                        <select class="setting-control" id="profileVisibility">
                            <option value="public">Public</option>
                            <option value="private">Private</option>
                            <option value="friends">Friends Only</option>
                        </select>
                    </div>
                    
                    <div class="setting-item">
                        <label class="setting-label">Two-Factor Authentication</label>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span>Enable 2FA</span>
                            <label class="toggle-switch">
                                <input type="checkbox" id="twoFactorAuth">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                    
                    <div style="margin-top: 30px;">
                        <button class="profile-btn btn-danger" onclick="deleteAccount()" style="width: 100%;">
                            üóëÔ∏è Delete Account
                        </button>
                        <small style="color: var(--text-gray); display: block; margin-top: 10px; text-align: center;">
                            This action cannot be undone
                        </small>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Referral Tab -->
        <div class="tab-content hidden" id="referralTab">
            <div class="referral-section">
                <h2 class="section-title">üë• Referral Program</h2>
                <p style="color: var(--text-gray); margin-bottom: 20px; max-width: 600px; margin-left: auto; margin-right: auto;">
                    Invite friends to Scratch C and earn 10% of their earnings for life! Share your unique referral link below.
                </p>
                
                <div class="referral-code" id="referralCode">
                    Loading...
                </div>
                
                <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
                    <button class="profile-btn btn-primary" onclick="copyReferralLink()">
                        üìã Copy Link
                    </button>
                    <button class="profile-btn btn-secondary" onclick="shareReferralLink()">
                        üì± Share
                    </button>
                    <button class="profile-btn" style="background: var(--wine); color: white;" onclick="viewReferrals()">
                        üë• View Referrals
                    </button>
                </div>
                
                <div class="referral-stats">
                    <div class="stat-item">
                        <div class="stat-number" id="referralCount">0</div>
                        <div class="stat-label">Referred Users</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="referralEarningsTotal">‚Ç¶0</div>
                        <div class="stat-label">Referral Earnings</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="referralActive">0</div>
                        <div class="stat-label">Active Referrals</div>
                    </div>
                </div>
                
                <div style="margin-top: 40px;">
                    <h3 style="color: var(--gold); margin-bottom: 20px;">üì¢ Share on Social Media</h3>
                    <div class="social-links">
                        <a href="#" class="social-link" onclick="shareOnWhatsApp()">üí¨</a>
                        <a href="#" class="social-link" onclick="shareOnTelegram()">üì±</a>
                        <a href="#" class="social-link" onclick="shareOnFacebook()">üìò</a>
                        <a href="#" class="social-link" onclick="shareOnTwitter()">üê¶</a>
                        <a href="#" class="social-link" onclick="shareViaEmail()">üìß</a>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Ads Container -->
        <div class="ads-container">
            <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1883805796264049" crossorigin="anonymous"></script>
            <ins class="adsbygoogle"
                style="display:block"
                data-ad-client="ca-pub-1883805796264049"
                data-ad-slot="3768074715"
                data-ad-format="auto"
                data-full-width-responsive="true"></ins>
            <script>
                (adsbygoogle = window.adsbygoogle || []).push({});
            </script>
        </div>
        
        <!-- Footer -->
        <footer class="footer">
            <p>¬© 2024 Scratch C Profile. Your personal dashboard.</p>
            <p style="font-size: 0.9rem; margin-top: 10px;">Account created on <span id="accountCreated">Loading...</span></p>
        </footer>
    </div>
    
    <!-- Avatar Upload Modal -->
    <div id="avatarModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">üñºÔ∏è Change Profile Picture</h2>
                <button class="close-modal" onclick="closeAvatarUpload()">√ó</button>
            </div>
            <div class="modal-body">
                <div style="text-align: center; margin-bottom: 30px;">
                    <div style="width: 200px; height: 200px; border-radius: 50%; border: 3px solid var(--gold); margin: 0 auto 20px; overflow: hidden;">
                        <img id="avatarPreview" src="" alt="Preview" style="width:100%; height:100%; object-fit:cover;">
                    </div>
                    <input type="file" id="avatarUpload" accept="image/*" style="display: none;" onchange="previewAvatar(event)">
                    <button class="profile-btn btn-secondary" onclick="document.getElementById('avatarUpload').click()">
                        üìÅ Choose Image
                    </button>
                </div>
                
                <div class="form-actions">
                    <button class="submit-btn" onclick="uploadAvatar()">
                        Save Avatar
                    </button>
                    <button class="profile-btn btn-danger" onclick="closeAvatarUpload()">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Edit Profile Modal -->
    <div id="editProfileModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">‚úèÔ∏è Edit Profile</h2>
                <button class="close-modal" onclick="closeEditProfile()">√ó</button>
            </div>
            <div class="modal-body">
                <form id="editProfileForm" onsubmit="updateProfile(event)">
                    <div class="form-group">
                        <label class="form-label">Full Name</label>
                        <input type="text" id="editFullName" class="form-control" placeholder="Enter your full name">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Bio</label>
                        <textarea id="editBio" class="form-control" rows="3" placeholder="Tell us about yourself..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Phone Number</label>
                        <input type="tel" id="editPhone" class="form-control" placeholder="Enter phone number">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Location</label>
                        <input type="text" id="editLocation" class="form-control" placeholder="Enter your location">
                    </div>
                    
                    <div class="form-actions">
                        <button type="submit" class="submit-btn">
                            Save Changes
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Withdraw Modal -->
    <div id="withdrawModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">üí∞ Withdraw Earnings</h2>
                <button class="close-modal" onclick="closeWithdrawModal()">√ó</button>
            </div>
            <div class="modal-body">
                <div style="text-align: center; margin-bottom: 30px;">
                    <div style="font-size: 3rem; color: var(--gold);">üí∞</div>
                    <div style="font-size: 2rem; color: var(--green); font-weight: bold;" id="availableWithdraw">
                        ‚Ç¶0.00
                    </div>
                    <div style="color: var(--text-gray);">Available for withdrawal</div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Withdrawal Amount (‚Ç¶)</label>
                    <input type="number" id="withdrawAmount" class="form-control" placeholder="Enter amount" min="1000">
                    <small style="color: var(--text-gray); display: block; margin-top: 5px;">Minimum: ‚Ç¶1,000</small>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Withdrawal Method</label>
                    <div class="withdraw-options">
                        <div class="withdraw-option active" onclick="selectWithdrawMethod('bank')">
                            <div class="withdraw-icon">üè¶</div>
                            <div>Bank Transfer</div>
                        </div>
                        <div class="withdraw-option" onclick="selectWithdrawMethod('paypal')">
                            <div class="withdraw-icon">üí≥</div>
                            <div>PayPal</div>
                        </div>
                        <div class="withdraw-option" onclick="selectWithdrawMethod('airtime')">
                            <div class="withdraw-icon">üì±</div>
                            <div>Airtime</div>
                        </div>
                    </div>
                </div>
                
                <div class="form-group" id="bankDetails" style="display: block;">
                    <label class="form-label">Bank Account Details</label>
                    <input type="text" class="form-control" placeholder="Bank Name" id="bankName">
                    <input type="text" class="form-control" placeholder="Account Number" id="accountNumber" style="margin-top: 10px;">
                    <input type="text" class="form-control" placeholder="Account Name" id="accountName" style="margin-top: 10px;">
                </div>
                
                <div class="form-group" id="paypalDetails" style="display: none;">
                    <label class="form-label">PayPal Email</label>
                    <input type="email" class="form-control" placeholder="Enter PayPal email" id="paypalEmail">
                </div>
                
                <div class="form-group" id="airtimeDetails" style="display: none;">
                    <label class="form-label">Phone Number</label>
                    <input type="tel" class="form-control" placeholder="Enter phone number for airtime" id="airtimeNumber">
                    <select class="form-control" id="airtimeNetwork" style="margin-top: 10px;">
                        <option value="">Select Network</option>
                        <option value="mtn">MTN</option>
                        <option value="airtel">Airtel</option>
                        <option value="glo">Glo</option>
                        <option value="9mobile">9mobile</option>
                    </select>
                </div>
                
                <div class="form-actions">
                    <button class="submit-btn" onclick="processWithdrawal()">
                        Request Withdrawal
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Referrals Modal -->
    <div id="referralsModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">üë• My Referrals</h2>
                <button class="close-modal" onclick="closeReferralsModal()">√ó</button>
            </div>
            <div class="modal-body">
                <div id="referralsList">
                    <div class="loading">Loading referrals...</div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        let currentUser = null;
        let userProfile = null;
        let activities = [];
        let currentWithdrawMethod = 'bank';
        
        // Initialize profile page
        window.onload = async function() {
            await checkAuth();
            await loadUserProfile();
            await loadUserActivities();
            setupPage();
        };
        
        // Check authentication
        async function checkAuth() {
            const token = localStorage.getItem('token');
            if (!token) {
                window.location.href = '/';
                return;
            }
            
            try {
                const response = await fetch('/api/auth/verify', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (!response.ok) {
                    localStorage.removeItem('token');
                    localStorage.removeItem('user');
                    window.location.href = '/';
                }
            } catch (error) {
                localStorage.removeItem('token');
                localStorage.removeItem('user');
                window.location.href = '/';
            }
        }
        
        // Load user profile
        async function loadUserProfile() {
            const token = localStorage.getItem('token');
            const storedUser = localStorage.getItem('user');
            
            if (storedUser) {
                currentUser = JSON.parse(storedUser);
                updateUserDisplay();
            }
            
            try {
                const response = await fetch('/api/users/profile', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (response.ok) {
                    userProfile = await response.json();
                    currentUser = userProfile.user;
                    localStorage.setItem('user', JSON.stringify(currentUser));
                    updateProfileDisplay();
                }
            } catch (error) {
                console.error('Error loading profile:', error);
                // Fallback to basic user data
                if (currentUser) {
                    updateProfileDisplay();
                }
            }
        }
        
        // Update user display
        function updateUserDisplay() {
            if (!currentUser) return;
            
            document.getElementById('balanceAmount').textContent = `‚Ç¶${currentUser.balance.toFixed(2)}`;
            document.getElementById('profileInitial').textContent = currentUser.username?.charAt(0).toUpperCase() || 'U';
            
            const colors = ['#0000FF', '#00FF00', '#722F37', '#FFD700', '#FF0000'];
            const colorIndex = (currentUser.username?.length || 0) % colors.length;
            document.getElementById('profilePic').style.background = colors[colorIndex];
        }
        
        // Update profile display
        function updateProfileDisplay() {
            if (!currentUser) return;
            
            // Basic info
            document.getElementById('profileName').textContent = currentUser.username || 'User';
            document.getElementById('avatarImage').src = currentUser.profilePic || '';
            document.getElementById('avatarPreview').src = currentUser.profilePic || '';
            document.getElementById('profileInitial').textContent = currentUser.username?.charAt(0).toUpperCase() || 'U';
            
            // Stats
            const createdDate = new Date(currentUser.createdAt);
            const today = new Date();
            const daysSince = Math.floor((today - createdDate) / (1000 * 60 * 60 * 24));
            
            document.getElementById('memberSince').textContent = daysSince;
            document.getElementById('tasksCount').textContent = currentUser.tasksCompleted?.length || 0;
            document.getElementById('booksRead').textContent = currentUser.readingHistory?.length || 0;
            document.getElementById('listingsCount').textContent = currentUser.marketplaceListings?.length || 0;
            
            // Earnings
            document.getElementById('totalEarned').textContent = `‚Ç¶${(currentUser.totalEarned || 0).toFixed(2)}`;
            document.getElementById('availableBalance').textContent = `‚Ç¶${(currentUser.balance || 0).toFixed(2)}`;
            document.getElementById('availableWithdraw').textContent = `‚Ç¶${(currentUser.balance || 0).toFixed(2)}`;
            
            // Badge
            updateUserBadge();
            
            // Settings form
            document.getElementById('settingsUsername').value = currentUser.username || '';
            document.getElementById('settingsEmail').value = currentUser.email || '';
            
            // Referral
            document.getElementById('referralCode').textContent = currentUser.referralCode || `SCRATCH-${currentUser.username?.toUpperCase()}`;
            
            // Account created date
            document.getElementById('accountCreated').textContent = createdDate.toLocaleDateString();
            
            // Withdrawn amount
            const withdrawn = currentUser.totalEarned - currentUser.balance;
            document.getElementById('withdrawnAmount').textContent = `‚Ç¶${withdrawn > 0 ? withdrawn.toFixed(2) : '0.00'}`;
            
            // Platform fees (20% of total earned)
            const platformFees = (currentUser.totalEarned || 0) * 0.20;
            document.getElementById('platformCut').textContent = `‚Ç¶${platformFees.toFixed(2)}`;
            
            // Referral stats
            document.getElementById('referralCount').textContent = currentUser.referrals?.length || 0;
            document.getElementById('referralEarningsTotal').textContent = `‚Ç¶${(currentUser.referralEarnings || 0).toFixed(2)}`;
            document.getElementById('referralActive').textContent = currentUser.activeReferrals || 0;
            
            // Earnings breakdown
            document.getElementById('offerwallEarnings').textContent = `‚Ç¶${(currentUser.offerwallEarnings || 0).toFixed(2)}`;
            document.getElementById('referralEarnings').textContent = `‚Ç¶${(currentUser.referralEarnings || 0).toFixed(2)}`;
            document.getElementById('donationEarnings').textContent = `‚Ç¶${(currentUser.donationEarnings || 0).toFixed(2)}`;
            document.getElementById('totalEarningsBreakdown').textContent = `‚Ç¶${(currentUser.totalEarned || 0).toFixed(2)}`;
        }
        
        // Update user badge
        function updateUserBadge() {
            const badge = document.getElementById('userBadge');
            const badgeIcon = document.getElementById('badgeIcon');
            const badgeText = document.getElementById('badgeText');
            
            let badgeLevel = 'Member';
            let badgeColor = 'var(--wine)';
            let icon = '‚≠ê';
            
            const totalEarned = currentUser.totalEarned || 0;
            const tasksCompleted = currentUser.tasksCompleted?.length || 0;
            
            if (totalEarned >= 50000) {
                badgeLevel = 'VIP Elite';
                badgeColor = 'var(--gold)';
                icon = 'üëë';
            } else if (totalEarned >= 10000) {
                badgeLevel = 'Gold Member';
                badgeColor = 'var(--gold)';
                icon = '‚≠ê';
            } else if (totalEarned >= 1000) {
                badgeLevel = 'Silver Member';
                badgeColor = '#C0C0C0';
                icon = 'ü•à';
            } else if (tasksCompleted >= 10) {
                badgeLevel = 'Active Member';
                badgeColor = 'var(--green)';
                icon = 'üöÄ';
            }
            
            badge.style.background = badgeColor;
            badgeIcon.textContent = icon;
            badgeText.textContent = badgeLevel;
        }
        
        // Load user activities
        async function loadUserActivities() {
            try {
                const token = localStorage.getItem('token');
                const response = await fetch('/api/users/activities', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (response.ok) {
                    activities = await response.json();
                    renderRecentActivity();
                    renderActivityList();
                }
            } catch (error) {
                console.error('Error loading activities:', error);
                activities = [];
                renderRecentActivity();
                renderActivityList();
            }
        }
        
        // Render recent activity
        function renderRecentActivity() {
            const container = document.getElementById('recentActivity');
            
            if (activities.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: var(--text-gray);">
                        <div style="font-size: 3rem; margin-bottom: 15px;">üìä</div>
                        <h3 style="color: var(--gold); margin-bottom: 10px;">No Activity Yet</h3>
                        <p>Start earning by completing tasks or exploring the app!</p>
                    </div>
                `;
                return;
            }
            
            const recent = activities.slice(0, 5);
            container.innerHTML = recent.map(activity => `
                <div class="task-item">
                    <div class="task-info">
                        <h4>${activity.title}</h4>
                        <div class="task-date">${new Date(activity.date).toLocaleString()}</div>
                    </div>
                    ${activity.amount ? `<div class="task-amount">+‚Ç¶${activity.amount}</div>` : ''}
                </div>
            `).join('');
        }
        
        // Render activity list
        function renderActivityList(filter = 'all') {
            const container = document.getElementById('activityList');
            
            let filteredActivities = activities;
            if (filter !== 'all') {
                filteredActivities = activities.filter(activity => 
                    activity.type === filter
                );
            }
            
            if (filteredActivities.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: var(--text-gray);">
                        <div style="font-size: 3rem; margin-bottom: 15px;">üìä</div>
                        <h3 style="color: var(--gold); margin-bottom: 10px;">No ${filter === 'all' ? '' : filter} Activities</h3>
                        <p>${getNoActivityMessage(filter)}</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = filteredActivities.map(activity => `
                <div class="task-item">
                    <div class="task-info">
                        <h4>${activity.title}</h4>
                        <div class="task-date">${new Date(activity.date).toLocaleString()}</div>
                        <div style="color: var(--text-gray); font-size: 0.9rem; margin-top: 5px;">
                            ${activity.description || ''}
                        </div>
                    </div>
                    ${activity.amount ? `<div class="task-amount">+‚Ç¶${activity.amount}</div>` : ''}
                </div>
            `).join('');
        }
        
        // Get no activity message
        function getNoActivityMessage(filter) {
            switch(filter) {
                case 'tasks': return 'Complete offerwall tasks to see your earnings here.';
                case 'reading': return 'Start reading books to track your progress.';
                case 'marketplace': return 'Buy or sell items in the marketplace.';
                case 'cinema': return 'Watch and vote for movies in the cinema.';
                default: return 'Start exploring the app to see activities here.';
            }
        }
        
        // Show tab
        function showTab(tabName) {
            // Hide all tabs
            document.getElementById('overviewTab').classList.add('hidden');
            document.getElementById('earningsTab').classList.add('hidden');
            document.getElementById('activityTab').classList.add('hidden');
            document.getElementById('settingsTab').classList.add('hidden');
            document.getElementById('referralTab').classList.add('hidden');
            
            // Remove active class from all tabs
            document.querySelectorAll('.profile-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(`${tabName}Tab`).classList.remove('hidden');
            
            // Add active class to clicked tab
            event.target.classList.add('active');
        }
        
        // Filter activity
        function filterActivity(type) {
            // Update active filter button
            document.querySelectorAll('#activityTab .profile-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Render filtered activities
            renderActivityList(type);
        }
        
        // Open avatar upload
        function openAvatarUpload() {
            document.getElementById('avatarModal').classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }
        
        // Close avatar upload
        function closeAvatarUpload() {
            document.getElementById('avatarModal').classList.add('hidden');
            document.body.style.overflow = 'auto';
            document.getElementById('avatarUpload').value = '';
        }
        
        // Preview avatar
        function previewAvatar(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('avatarPreview').src = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        }
        
        // Upload avatar
        async function uploadAvatar() {
            const fileInput = document.getElementById('avatarUpload');
            if (!fileInput.files[0]) {
                alert('Please select an image first.');
                return;
            }
            
            const formData = new FormData();
            formData.append('avatar', fileInput.files[0]);
            
            try {
                const token = localStorage.getItem('token');
                const response = await fetch('/api/users/avatar', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    },
                    body: formData
                });
                
                if (response.ok) {
                    const result = await response.json();
                    currentUser.profilePic = result.profilePic;
                    localStorage.setItem('user', JSON.stringify(currentUser));
                    updateProfileDisplay();
                    closeAvatarUpload();
                    alert('Profile picture updated successfully!');
                } else {
                    alert('Failed to upload avatar. Please try again.');
                }
            } catch (error) {
                console.error('Error uploading avatar:', error);
                alert('Network error. Please try again.');
            }
        }
        
        // Open edit profile
        function openEditProfile() {
            document.getElementById('editProfileModal').classList.remove('hidden');
            document.body.style.overflow = 'hidden';
            
            // Populate form with current data
            document.getElementById('editFullName').value = currentUser.fullName || '';
            document.getElementById('editBio').value = currentUser.bio || '';
            document.getElementById('editPhone').value = currentUser.phone || '';
            document.getElementById('editLocation').value = currentUser.location || '';
        }
        
        // Close edit profile
        function closeEditProfile() {
            document.getElementById('editProfileModal').classList.add('hidden');
            document.body.style.overflow = 'auto';
        }
        
        // Update profile
        async function updateProfile(event) {
            event.preventDefault();
            
            const formData = {
                fullName: document.getElementById('editFullName').value,
                bio: document.getElementById('editBio').value,
                phone: document.getElementById('editPhone').value,
                location: document.getElementById('editLocation').value
            };
            
            try {
                const token = localStorage.getItem('token');
                const response = await fetch('/api/users/profile', {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });
                
                if (response.ok) {
                    const updated = await response.json();
                    currentUser = { ...currentUser, ...updated.user };
                    localStorage.setItem('user', JSON.stringify(currentUser));
                    updateProfileDisplay();
                    closeEditProfile();
                    alert('Profile updated successfully!');
                } else {
                    alert('Failed to update profile.');
                }
            } catch (error) {
                console.error('Error updating profile:', error);
                alert('Network error. Please try again.');
            }
        }
        
        // Open withdraw modal
        function openWithdrawModal() {
            document.getElementById('withdrawModal').classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }
        
        // Close withdraw modal
        function closeWithdrawModal() {
            document.getElementById('withdrawModal').classList.add('hidden');
            document.body.style.overflow = 'auto';
        }
        
        // Select withdraw method
        function selectWithdrawMethod(method) {
            currentWithdrawMethod = method;
            
            // Update UI
            document.querySelectorAll('.withdraw-option').forEach(option => {
                option.classList.remove('active');
            });
            event.target.closest('.withdraw-option').classList.add('active');
            
            // Show relevant details
            document.getElementById('bankDetails').style.display = 'none';
            document.getElementById('paypalDetails').style.display = 'none';
            document.getElementById('airtimeDetails').style.display = 'none';
            
            if (method === 'bank') {
                document.getElementById('bankDetails').style.display = 'block';
            } else if (method === 'paypal') {
                document.getElementById('paypalDetails').style.display = 'block';
            } else if (method === 'airtime') {
                document.getElementById('airtimeDetails').style.display = 'block';
            }
        }
        
        // Process withdrawal
        async function processWithdrawal() {
            const amount = parseFloat(document.getElementById('withdrawAmount').value);
            const balance = currentUser.balance || 0;
            
            if (!amount || amount < 1000) {
                alert('Minimum withdrawal amount is ‚Ç¶1,000');
                return;
            }
            
            if (amount > balance) {
                alert('Insufficient balance. You cannot withdraw more than your available balance.');
                return;
            }
            
            let details = {};
            if (currentWithdrawMethod === 'bank') {
                details = {
                    bankName: document.getElementById('bankName').value,
                    accountNumber: document.getElementById('accountNumber').value,
                    accountName: document.getElementById('accountName').value
                };
                
                if (!details.bankName || !details.accountNumber || !details.accountName) {
                    alert('Please fill in all bank details.');
                    return;
                }
            } else if (currentWithdrawMethod === 'paypal') {
                details = {
                    paypalEmail: document.getElementById('paypalEmail').value
                };
                
                if (!details.paypalEmail) {
                    alert('Please enter your PayPal email.');
                    return;
                }
            } else if (currentWithdrawMethod === 'airtime') {
                details = {
                    phoneNumber: document.getElementById('airtimeNumber').value,
                    network: document.getElementById('airtimeNetwork').value
                };
                
                if (!details.phoneNumber || !details.network) {
                    alert('Please fill in all airtime details.');
                    return;
                }
            }
            
            const confirmWithdraw = confirm(`Are you sure you want to withdraw ‚Ç¶${amount.toFixed(2)} to ${currentWithdrawMethod}?`);
            if (!confirmWithdraw) return;
            
            try {
                const token = localStorage.getItem('token');
                const response = await fetch('/api/users/withdraw', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        amount,
                        method: currentWithdrawMethod,
                        details
                    })
                });
                
                if (response.ok) {
                    const result = await response.json();
                    alert(`Withdrawal request submitted successfully! Transaction ID: ${result.transactionId}`);
                    closeWithdrawModal();
                    await loadUserProfile();
                } else {
                    const error = await response.json();
                    alert(error.message || 'Withdrawal failed. Please try again.');
                }
            } catch (error) {
                console.error('Error processing withdrawal:', error);
                alert('Network error. Please try again.');
            }
        }
        
        // Copy referral link
        function copyReferralLink() {
            const referralCode = document.getElementById('referralCode').textContent;
            const referralLink = `${window.location.origin}/?ref=${referralCode}`;
            
            navigator.clipboard.writeText(referralLink).then(() => {
                alert('Referral link copied to clipboard!');
            });
        }
        
        // Share referral link
        function shareReferralLink() {
            const referralCode = document.getElementById('referralCode').textContent;
            const referralLink = `${window.location.origin}/?ref=${referralCode}`;
            const message = `Join me on Scratch C and start earning money! Use my referral code: ${referralCode}\n${referralLink}`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'Join Scratch C',
                    text: message,
                    url: referralLink
                });
            } else {
                navigator.clipboard.writeText(message).then(() => {
                    alert('Referral message copied to clipboard! Share it with your friends.');
                });
            }
        }
        
        // View referrals
        async function viewReferrals() {
            try {
                const token = localStorage.getItem('token');
                const response = await fetch('/api/users/referrals', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (response.ok) {
                    const referrals = await response.json();
                    showReferralsModal(referrals);
                }
            } catch (error) {
                console.error('Error loading referrals:', error);
            }
        }
        
        // Show referrals modal
        function showReferralsModal(referrals) {
            const modal = document.getElementById('referralsModal');
            const list = document.getElementById('referralsList');
            
            if (referrals.length === 0) {
                list.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: var(--text-gray);">
                        <div style="font-size: 3rem; margin-bottom: 15px;">üë•</div>
                        <h3 style="color: var(--gold); margin-bottom: 10px;">No Referrals Yet</h3>
                        <p>Share your referral link to invite friends!</p>
                    </div>
                `;
            } else {
                list.innerHTML = referrals.map(ref => `
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 15px; background: rgba(0,0,0,0.3); margin-bottom: 10px; border-radius: 10px;">
                        <div>
                            <div style="font-weight: bold; color: var(--gold);">${ref.username}</div>
                            <div style="color: var(--text-gray); font-size: 0.9rem;">
                                Joined: ${new Date(ref.joinedAt).toLocaleDateString()}
                            </div>
                        </div>
                        <div style="text-align: right;">
                            <div style="color: var(--green); font-weight: bold;">‚Ç¶${(ref.earnedForYou || 0).toFixed(2)}</div>
                            <div style="color: var(--text-gray); font-size: 0.9rem;">Earned for you</div>
                        </div>
                    </div>
                `).join('');
            }
            
            modal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }
        
        // Close referrals modal
        function closeReferralsModal() {
            document.getElementById('referralsModal').classList.add('hidden');
            document.body.style.overflow = 'auto';
        }
        
        // Update profile settings
        async function updateProfileSettings() {
            const username = document.getElementById('settingsUsername').value;
            const email = document.getElementById('settingsEmail').value;
            const password = document.getElementById('settingsPassword').value;
            
            if (!username || !email) {
                alert('Username and email are required.');
                return;
            }
            
            const updates = { username, email };
            if (password) updates.password = password;
            
            try {
                const token = localStorage.getItem('token');
                const response = await fetch('/api/users/settings', {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(updates)
                });
                
                if (response.ok) {
                    alert('Settings updated successfully!');
                    await loadUserProfile();
                } else {
                    const error = await response.json();
                    alert(error.message || 'Failed to update settings.');
                }
            } catch (error) {
                console.error('Error updating settings:', error);
                alert('Network error. Please try again.');
            }
        }
        
        // Select theme
        function selectTheme(theme) {
            document.querySelectorAll('.theme-option').forEach(option => {
                option.classList.remove('active');
            });
            event.target.closest('.theme-option').classList.add('active');
            
            // Save theme preference
            localStorage.setItem('theme', theme);
            applyTheme(theme);
        }
        
        // Apply theme
        function applyTheme(theme) {
            if (theme === 'dark' || (theme === 'auto' && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                document.documentElement.style.setProperty('--bg-dark', '#121212');
                document.documentElement.style.setProperty('--bg-light', '#1E1E1E');
            } else {
                document.documentElement.style.setProperty('--bg-dark', '#f5f5f5');
                document.documentElement.style.setProperty('--bg-light', '#ffffff');
            }
        }
        
        // Delete account
        function deleteAccount() {
            const confirmDelete = confirm('Are you sure you want to delete your account? This action cannot be undone and all your data will be lost.');
            
            if (confirmDelete) {
                const reason = prompt('Please tell us why you are leaving:');
                if (reason !== null) {
                    // In a real app, you would call an API to delete the account
                    alert('Account deletion requested. Our team will process your request within 24 hours.');
                }
            }
        }
        
        // Logout
        function logout() {
            localStorage.clear();
            window.location.href = '/';
        }
        
        // Share functions
        function shareOnWhatsApp() {
            const referralCode = document.getElementById('referralCode').textContent;
            const message = `Join me on Scratch C! Use my referral code: ${referralCode}`;
            window.open(`https://wa.me/?text=${encodeURIComponent(message)}`, '_blank');
        }
        
        function shareOnTelegram() {
            const referralCode = document.getElementById('referralCode').textContent;
            const message = `Join me on Scratch C! Use my referral code: ${referralCode}`;
            window.open(`https://t.me/share/url?url=${encodeURIComponent(window.location.origin)}&text=${encodeURIComponent(message)}`, '_blank');
        }
        
        function shareOnFacebook() {
            window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(window.location.origin)}`, '_blank');
        }
        
        function shareOnTwitter() {
            const message = `Join me on Scratch C and start earning!`;
            window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(message)}&url=${encodeURIComponent(window.location.origin)}`, '_blank');
        }
        
        function shareViaEmail() {
            const referralCode = document.getElementById('referralCode').textContent;
            const subject = 'Join me on Scratch C!';
            const body = `Hi! I'm using Scratch C to earn money by completing tasks, watching movies, reading books, and more. Join me using my referral code: ${referralCode}\n\n${window.location.origin}`;
            window.location.href = `mailto:?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
        }
        
        // Setup page
        function setupPage() {
            // Setup admin access
            setupAdminAccess();
            
            // Load saved theme
            const savedTheme = localStorage.getItem('theme') || 'dark';
            document.querySelectorAll('.theme-option').forEach(option => {
                if (option.textContent.trim() === savedTheme.charAt(0).toUpperCase() + savedTheme.slice(1)) {
                    option.classList.add('active');
                }
            });
            applyTheme(savedTheme);
            
            // Load saved settings
            document.getElementById('emailNotifications').checked = localStorage.getItem('emailNotifications') !== 'false';
            document.getElementById('pushNotifications').checked = localStorage.getItem('pushNotifications') !== 'false';
            
            // Close modals on escape
            document.addEventListener('keydown', function(event) {
                if (event.key === 'Escape') {
                    closeAvatarUpload();
                    closeEditProfile();
                    closeWithdrawModal();
                    closeReferralsModal();
                }
            });
        }
        
        // Setup admin access
        function setupAdminAccess() {
            const profilePic = document.getElementById('profilePic');
            let tapCount = 0;
            let tapTimer = null;
            
            profilePic.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                
                tapCount++;
                
                clearTimeout(tapTimer);
                tapTimer = setTimeout(() => {
                    tapCount = 0;
                }, 3000);
                
                if (tapCount >= 7) {
                    tapCount = 0;
                    window.location.href = '/admin';
                }
            });
        }
    </script>
</body>
</html>